#!/bin/bash
# .husky/pre-commit

npx lint-staged

echo "K√∂r pre-commit kontroll..."

# Namnet p√• detta skript s√• vi kan exkludera det
SELF=".husky/pre-commit"

echo "S√∂ker efter debug-kod (ignorerar $SELF)..."

# 1. git diff --cached : kolla det som √§r i staging
# 2. -- . ":!$SELF"   : ignorera mig sj√§lv...
# 3. grep "^+"         : kolla bara tillagda rader
# 4. grep -v "^+++"    : ignorera filhuvudet i diffen
# 5. grep -E ...       : leta efter f√∂rbjudna ord
DEBUG_FOUND=$(git diff --cached --unified=0 -- . ":!$SELF" | grep "^+" | grep -v "^+++" | grep -E "console\.log|debugger|TODO: REMOVE" || true)

if [ ! -z "$DEBUG_FOUND" ]; then
    echo ""
    echo "‚ö†Ô∏è  STOPP!"
    echo "F√∂ljande debug-kod hittades i √§ndringarna som du vill committa:"
    echo "------------------------------------------------------------"
    echo "$DEBUG_FOUND"
    echo "------------------------------------------------------------"
    echo "Ta bort detta eller anv√§nd 'git commit --no-verify' om du verkligen vill committa din √§ndringar."
    exit 1
fi

echo "‚úÖ Inga problem hittade!"
echo "üìù Forts√§tter med commit..."
exit 0
